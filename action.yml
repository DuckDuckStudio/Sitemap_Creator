name: Sitemap Creator Stable
description: GitHub Action ğŸš€ for creating and updating sitemaps in your repository.
author: é¸­é¸­ã€Œã‚«ãƒ¢ã€(@DuckDuckStudio)

branding:
  color: yellow
  icon: book

keywords:
  [
    'sitemap',
    'website',
    'seo',
    'creator',
    'updater',
    'generator',
    'urls'
  ]

inputs:
  location:
    required: false
    description: ç½‘ç«™åœ°å›¾çš„å­˜æ”¾ä½ç½® (ä¾‹å¦‚ docs/sitemap.xml)
    default: "./sitemap.xml"

  token:
    required: false
    description: ç”¨äºåˆ›å»ºæ›´æ–°ç½‘ç«™åœ°å›¾çš„æ‹‰å–è¯·æ±‚çš„ Token (ä¸æŒ‡å®šåˆ™ä½¿ç”¨ github.token)
    default: ${{ github.token }}

  timezone:
    required: false
    description: è®¾ç½®ç”Ÿæˆæ—¶ä½¿ç”¨çš„æ—¶åŒº (ä¸æŒ‡å®šåˆ™ä½¿ç”¨ Asia/Shanghai (UTF+8))
    default: "Asia/Shanghai"

  basic_link:
    required: false
    description: æŒ‡å‘ä½ ç½‘ç«™çš„åŸºç¡€é“¾æ¥ (ä¸æŒ‡å®šåˆ™ä½¿ç”¨ GitHub Page é“¾æ¥, ç»“å°¾ä¸è¦å¸¦ / )
    default: https://${{ github.event.repository.owner.login }}.github.io/${{ github.event.repository.name }}

  file_type:
    required: false
    description: ç½‘é¡µæ–‡ä»¶çš„ç±»å‹ (ä¾‹å¦‚ä½¿ç”¨ docsify éƒ¨ç½²çš„å°±æ˜¯ mdï¼Œå¯æŒ‡å®šå¤šä¸ªç±»å‹)
    default: "html,md"

  ignore_file:
    required: false
    description: æŒ‡å®šå“ªäº›æ–‡ä»¶ä¸åŒ…å«åœ¨ç½‘ç«™åœ°å›¾ä¸­
    default: "å•¥éƒ½æ²¡æœ‰" # åº”è¯¥ä¸ä¼šæœ‰äººè¦è¿™ä¸ªï¼Œç•™ç©ºä¼šå¿½ç•¥æ‰€æœ‰æ–‡ä»¶

  website_path:
    required: true
    description: ä½ çš„ç½‘ç«™å†…å®¹çš„ä½ç½® (ä¾‹å¦‚ . (æ ¹ç›®å½•) æˆ– docs)
    default: "./"

  base_branch:
    required: false
    description: ä»“åº“ä¸»åˆ†æ”¯ (mainï¼Œmaster ç­‰)
    default: main

  debug:
    required: false
    description: æ§åˆ¶è°ƒè¯•è¾“å‡ºçš„å¼€å…³
    default: false

  label:
    required: false
    description: åˆ›å»ºæ‹‰å–è¯·æ±‚æ—¶æ·»åŠ çš„æ ‡ç­¾

  auto_merge:
    required: false
    description: è®¾ç½®å¯ç”¨è‡ªåŠ¨åˆå¹¶çš„ç±»å‹ (ä¸æŒ‡å®šåˆ™ä¸å¯ç”¨è‡ªåŠ¨åˆå¹¶ï¼Œå¯ä»¥ä½¿ç”¨ mergeã€rebaseã€squash)

  update:
    required: false
    description: æŒ‡å®šæ›´æ–°ç½‘ç«™åœ°å›¾çš„æ–¹å¼ (ç›´æ¥æäº¤æˆ–æ‹‰å–è¯·æ±‚)
    default: æ‹‰å–è¯·æ±‚

  reviewer:
    required: false
    description: åˆ›å»ºæ‹‰å–è¯·æ±‚æ—¶æŒ‡å®šçš„å®¡æŸ¥è€…

  author_name:
    required: false
    description: æ›´æ–°æäº¤çš„æ’°å†™è€…å
    default: "github-actions[bot]"

  author_email:
    required: false
    description: æ›´æ–°æäº¤çš„æ’°å†™è€…é‚®ç®±
    default: "41898282+github-actions[bot]@users.noreply.github.com"

runs:
  using: composite
  steps:
    - name: æ£€å‡ºä»“åº“
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # æ£€å‡ºå®Œæ•´è®°å½•
        # ref: ${{ inputs.base_branch }} ä¸ç¡®å®šè¿™ä¸ªè¦ä¸è¦åŠ ï¼Œåç»­çœ‹æƒ…å†µå§

    - name: è®¾ç½® Node.js ç¯å¢ƒ
      uses: actions/setup-node@v4
      with:
        node-version: "latest"

    - name: è®¾ç½®æ—¶åŒº
      shell: bash
      if: ${{ runner.os == 'Linux' }}
      env:
        TZ: ${{ inputs.timezone }}
      run: sudo timedatectl set-timezone $TZ

    - name: è®¾ç½®æ—¶åŒº
      shell: pwsh
      if: ${{ runner.os == 'Windows' }}
      env:
        TZ: ${{ inputs.timezone }}
      run: |
        $ErrorActionPreference = 'Stop' # æœ‰é”™è¯¯å°±åœæ­¢
        $tz = [System.TimeZoneInfo]::FindSystemTimeZoneById($env:TZ) # è·å–æ—¶åŒº
        [System.TimeZoneInfo]::Local = $tz # è®¾ç½®æ—¶åŒº

    - name: è®¾ç½®æ—¶åŒº
      shell: bash
      if: ${{ runner.os == 'macOS' }}
      env:
        TZ: ${{ inputs.timezone }}
      run: sudo systemsetup -settimezone $TZ

    - name: åˆ›å»º Sitemap
      shell: bash
      run: |
        # è·å–ç”Ÿæˆè„šæœ¬
        git clone https://github.com/DuckDuckStudio/Sitemap_Creator -b main # ç¨³å®šç‰ˆ
        cp Sitemap_Creator/index.mjs Sitemap_Creator.mjs
        rm -r Sitemap_Creator

        # ç”Ÿæˆç½‘ç«™åœ°å›¾
        node Sitemap_Creator.mjs
        rm Sitemap_Creator.mjs

    - name: æäº¤å¹¶æ¨é€ sitemap.xml
      shell: bash
      env:
        # è¿™å‡ ä¹åŒ…å«äº†æ‰€æœ‰çš„å‚æ•°
        GH_TOKEN: ${{ inputs.token }}
        LABELS: ${{ inputs.label }}
        DEBUG: ${{ inputs.debug }}
        AUTO_MERGE: ${{ inputs.auto_merge }}
        LOCATION: ${{ inputs.location }}
        UPDATE: ${{ inputs.update }}
        REVIEWER: ${{ inputs.reviewer }}
        TOKEN: ${{ github.token }}
        AUTHOR_NAME: ${{ inputs.author_name }}
        AUTHOR_EMAIL: ${{ inputs.author_email }}
        BASE_BRANCH: ${{ inputs.base_branch }}
        # ç”Ÿæˆæ—¶è¿˜éœ€è¦çš„å‚æ•°
        BASIC_LINK: ${{ inputs.basic_link }}
        FILE_TYPE: ${{ inputs.file_type }}
        IGNORE_FILE: ${{ inputs.ignore_file }}
        WEBSITE_PATH: ${{ inputs.website_path }}
      run: |
        node Sitemap_Push.mjs
